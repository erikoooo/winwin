<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾è‚¡æ¶¨å¹…æ’åè¿½è¸ªå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: bold;
            color: #34495e;
            font-size: 0.9em;
        }

        select, input, button {
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #c33;
        }

        .success {
            background: #e8f8e8;
            color: #2a7f2a;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2a7f2a;
        }

        .results {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .date-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #dee2e6;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .date-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .stock-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stock-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .rank {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .symbol {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .company-name {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .price {
            font-size: 1.1em;
            font-weight: bold;
            color: #2c3e50;
        }

        .change {
            font-size: 1.2em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3);
        }

        .volume {
            font-size: 0.8em;
            color: #95a5a6;
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .summary h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .api-config {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px dashed #667eea;
        }

        .api-config h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .api-config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .api-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 5px;
        }

        .api-status.active {
            background: #27ae60;
        }

        .api-status.inactive {
            background: #e74c3c;
        }

        .api-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border-left: 4px solid #667eea;
        }

        .api-info h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .api-info ul {
            color: #5a6c7d;
            line-height: 1.6;
        }

        .api-info li {
            margin-bottom: 8px;
        }

        .data-source-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stock-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ˆ ç¾è‚¡æ¶¨å¹…æ’åè¿½è¸ªå™¨</h1>
        
        <!-- APIé…ç½®åŒºåŸŸ -->
        <div class="api-config">
            <h3>âš™ï¸ APIé…ç½®ï¼ˆå¯é€‰ - ç”¨äºè·å–çœŸå®æ•°æ®ï¼‰</h3>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                è¾“å…¥APIå¯†é’¥åå¯è·å–çœŸå®è‚¡ç¥¨æ•°æ®ã€‚ç•™ç©ºå°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ã€‚
                <a href="#api-guide" style="color: #667eea;">è·å–å…è´¹APIå¯†é’¥æŒ‡å— â†“</a>
            </p>
            <div class="api-config-grid">
                <div class="control-group">
                    <label for="alphaVantageKey">
                        Alpha Vantage API Key
                        <span class="api-status" id="alphaStatus"></span>
                    </label>
                    <input type="text" id="alphaVantageKey" placeholder="è¾“å…¥APIå¯†é’¥æˆ–ä½¿ç”¨'demo'">
                </div>
                <div class="control-group">
                    <label for="finnhubKey">
                        Finnhub API Key
                        <span class="api-status" id="finnhubStatus"></span>
                    </label>
                    <input type="text" id="finnhubKey" placeholder="è¾“å…¥APIå¯†é’¥">
                </div>
                <div class="control-group">
                    <label for="polygonKey">
                        Polygon.io API Key
                        <span class="api-status" id="polygonStatus"></span>
                    </label>
                    <input type="text" id="polygonKey" placeholder="è¾“å…¥APIå¯†é’¥">
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="period">æ—¶é—´å‘¨æœŸ</label>
                <select id="period">
                    <option value="day">å½“æ—¥</option>
                    <option value="week" selected>æœ¬å‘¨</option>
                    <option value="month">æœ¬æœˆ</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="topN">æ˜¾ç¤ºå‰Nå</label>
                <input type="number" id="topN" min="1" max="50" value="10">
            </div>
            
            <div class="control-group">
                <label for="minPrice">æœ€ä½ä»·æ ¼è¿‡æ»¤</label>
                <input type="number" id="minPrice" min="0" step="0.01" value="0.1" placeholder="æœ€ä½ä»·æ ¼">
            </div>
            
            <button id="searchBtn">ğŸ” è·å–å®æ—¶æ•°æ®</button>
            <button id="refreshBtn">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <button id="generateCodeBtn">ğŸ“‹ ç”ŸæˆPythonä»£ç </button>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div>æ­£åœ¨è·å–æ•°æ®...</div>
            <div style="margin-top: 10px; font-size: 14px;">å°è¯•è¿æ¥çœŸå®APIä¸­...</div>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        <div id="success" class="success" style="display: none;"></div>
        
        <div id="results" class="results"></div>

        <div class="api-info" id="api-guide">
            <h3>ğŸ“Š å¦‚ä½•è·å–å…è´¹APIå¯†é’¥</h3>
            <ol style="line-height: 1.8;">
                <li><strong>Alpha Vantage (æ¨è)</strong>
                    <ul>
                        <li>è®¿é—®: <a href="https://www.alphavantage.co/support/#api-key" target="_blank">https://www.alphavantage.co</a></li>
                        <li>å…è´¹æ³¨å†Œå³å¯è·å¾—APIå¯†é’¥</li>
                        <li>æ”¯æŒè·å–å¸‚åœºæ¶¨è·Œå¹…æ¦œå•</li>
                    </ul>
                </li>
                <li><strong>Finnhub</strong>
                    <ul>
                        <li>è®¿é—®: <a href="https://finnhub.io/" target="_blank">https://finnhub.io</a></li>
                        <li>å…è´¹è®¡åˆ’æ¯åˆ†é’Ÿ60æ¬¡è¯·æ±‚</li>
                        <li>å®æ—¶è‚¡ç¥¨æŠ¥ä»·æ•°æ®</li>
                    </ul>
                </li>
                <li><strong>Polygon.io</strong>
                    <ul>
                        <li>è®¿é—®: <a href="https://polygon.io/" target="_blank">https://polygon.io</a></li>
                        <li>å…è´¹è®¡åˆ’æ¯åˆ†é’Ÿ5æ¬¡è¯·æ±‚</li>
                        <li>é«˜è´¨é‡é‡‘èæ•°æ®</li>
                    </ul>
                </li>
            </ol>
            <div style="margin-top: 15px; padding: 10px; background: #e8f4f8; border-radius: 5px;">
                <strong>ğŸ’¡ æç¤º:</strong> å¦‚æœä¸é…ç½®APIå¯†é’¥ï¼Œç³»ç»Ÿå°†ä½¿ç”¨åŸºäºå¸‚åœºæ¨¡å‹çš„æ¨¡æ‹Ÿæ•°æ®ã€‚
                æ¨¡æ‹Ÿæ•°æ®åŸºäºçœŸå®è‚¡ç¥¨çš„å†å²æ³¢åŠ¨æ€§å’Œè¶‹åŠ¿ç”Ÿæˆã€‚
            </div>
        </div>
    </div>

    <script>
        // çƒ­é—¨è‚¡ç¥¨åˆ—è¡¨ï¼ˆç”¨äºæ•°æ®è·å–ï¼‰
        const popularStocks = [
            'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'TSLA', 'META', 'NFLX', 'AMD', 'INTC',
            'ORCL', 'CRM', 'ADBE', 'PYPL', 'CMCSA', 'AVGO', 'TXN', 'COST', 'QCOM', 'TMUS',
            'ABNB', 'UBER', 'LYFT', 'ROKU', 'SQ', 'SHOP', 'ZOOM', 'DOCU', 'CRWD', 'OKTA',
            'PLTR', 'SNOW', 'DDOG', 'ZM', 'SPOT', 'TWLO', 'PINS', 'SNAP', 'BABA', 'JD',
            'COIN', 'HOOD', 'SOFI', 'UPST', 'AFRM', 'RBLX', 'RIVN', 'LCID', 'NKLA', 'SPCE'
        ];

        // APIé…ç½®ç®¡ç†
        const apiConfig = {
            alphaVantage: { key: '', status: false },
            finnhub: { key: '', status: false },
            polygon: { key: '', status: false }
        };

        // ä¿å­˜å’ŒåŠ è½½APIå¯†é’¥
        function saveApiKeys() {
            apiConfig.alphaVantage.key = document.getElementById('alphaVantageKey').value;
            apiConfig.finnhub.key = document.getElementById('finnhubKey').value;
            apiConfig.polygon.key = document.getElementById('polygonKey').value;
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('stockTrackerApiKeys', JSON.stringify({
                alphaVantage: apiConfig.alphaVantage.key,
                finnhub: apiConfig.finnhub.key,
                polygon: apiConfig.polygon.key
            }));
            
            updateApiStatus();
        }

        function loadApiKeys() {
            const saved = localStorage.getItem('stockTrackerApiKeys');
            if (saved) {
                const keys = JSON.parse(saved);
                document.getElementById('alphaVantageKey').value = keys.alphaVantage || '';
                document.getElementById('finnhubKey').value = keys.finnhub || '';
                document.getElementById('polygonKey').value = keys.polygon || '';
                
                apiConfig.alphaVantage.key = keys.alphaVantage || '';
                apiConfig.finnhub.key = keys.finnhub || '';
                apiConfig.polygon.key = keys.polygon || '';
            }
            updateApiStatus();
        }

        function updateApiStatus() {
            const alphaStatus = document.getElementById('alphaStatus');
            const finnhubStatus = document.getElementById('finnhubStatus');
            const polygonStatus = document.getElementById('polygonStatus');
            
            alphaStatus.className = 'api-status ' + (apiConfig.alphaVantage.key ? 'active' : 'inactive');
            finnhubStatus.className = 'api-status ' + (apiConfig.finnhub.key ? 'active' : 'inactive');
            polygonStatus.className = 'api-status ' + (apiConfig.polygon.key ? 'active' : 'inactive');
        }

        // è·å–è‚¡ç¥¨æ•°æ® - æ”¯æŒçœŸå®APIå’Œæ¨¡æ‹Ÿæ•°æ®
        async function fetchStockData(symbols, period = 'day') {
            let results = [];
            let dataSource = 'mock';
            
            // ä¿å­˜å½“å‰çš„APIé…ç½®
            saveApiKeys();
            
            // å°è¯•ä½¿ç”¨Alpha Vantage API
            if (apiConfig.alphaVantage.key && apiConfig.alphaVantage.key !== '') {
                try {
                    const response = await fetch(
                        `https://www.alphavantage.co/query?function=TOP_GAINERS_LOSERS&apikey=${apiConfig.alphaVantage.key}`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.top_gainers && !data.Note && !data.Information) {
                            results = data.top_gainers.map(stock => ({
                                symbol: stock.ticker,
                                company: stock.company_name || getCompanyName(stock.ticker),
                                price: parseFloat(stock.price),
                                change: parseFloat(stock.change_percentage.replace('%', '')),
                                volume: parseInt(stock.volume),
                                currency: 'USD',
                                lastUpdate: new Date().toISOString()
                            }));
                            dataSource = 'Alpha Vantage';
                            showSuccess(`æˆåŠŸä» ${dataSource} è·å–çœŸå®æ•°æ®ï¼`);
                        }
                    }
                } catch (error) {
                    console.error('Alpha Vantage APIé”™è¯¯:', error);
                }
            }
            
            // å¦‚æœAlpha Vantageå¤±è´¥ï¼Œå°è¯•Finnhub
            if (results.length === 0 && apiConfig.finnhub.key) {
                try {
                    // è·å–å¸‚åœºç¬¦å·
                    const symbolsResponse = await fetch(
                        `https://finnhub.io/api/v1/stock/symbol?exchange=US&token=${apiConfig.finnhub.key}`
                    );
                    
                    if (symbolsResponse.ok) {
                        const allSymbols = await symbolsResponse.json();
                        const targetSymbols = symbols.slice(0, 20); // é™åˆ¶æ•°é‡
                        
                        for (const symbol of targetSymbols) {
                            try {
                                const quoteResponse = await fetch(
                                    `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiConfig.finnhub.key}`
                                );
                                
                                if (quoteResponse.ok) {
                                    const quote = await quoteResponse.json();
                                    if (quote.dp && quote.dp > 0) {
                                        results.push({
                                            symbol: symbol,
                                            company: getCompanyName(symbol),
                                            price: quote.c,
                                            change: quote.dp,
                                            volume: quote.v || 0,
                                            currency: 'USD',
                                            lastUpdate: new Date(quote.t * 1000).toISOString()
                                        });
                                    }
                                }
                            } catch (err) {
                                continue;
                            }
                        }
                        
                        if (results.length > 0) {
                            dataSource = 'Finnhub';
                            showSuccess(`æˆåŠŸä» ${dataSource} è·å–çœŸå®æ•°æ®ï¼`);
                        }
                    }
                } catch (error) {
                    console.error('Finnhub APIé”™è¯¯:', error);
                }
            }
            
            // å¦‚æœéƒ½å¤±è´¥äº†ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
            if (results.length === 0) {
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                results = await generateRealisticMockData(symbols, period);
                if (apiConfig.alphaVantage.key || apiConfig.finnhub.key || apiConfig.polygon.key) {
                    showError('æ— æ³•è·å–çœŸå®æ•°æ®ï¼Œæ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®ã€‚è¯·æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®ã€‚');
                }
            }
            
            // æŒ‰æ¶¨å¹…æ’åº
            results.sort((a, b) => b.change - a.change);
            
            // æ·»åŠ æ•°æ®æºæ ‡è®°
            results = results.map(stock => ({
                ...stock,
                dataSource: dataSource
            }));
            
            return results;
        }

        // ç”ŸæˆçœŸå®æ„Ÿçš„æ¨¡æ‹Ÿæ•°æ®
        async function generateRealisticMockData(symbols, period) {
            // åŸºäºçœŸå®è‚¡ç¥¨çš„å†å²è¡¨ç°ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            const stockProfiles = {
                'AAPL': { basePrice: 190, volatility: 0.02, trend: 0.001 },
                'MSFT': { basePrice: 420, volatility: 0.018, trend: 0.0008 },
                'GOOGL': { basePrice: 140, volatility: 0.025, trend: 0.0005 },
                'AMZN': { basePrice: 180, volatility: 0.03, trend: 0.0003 },
                'NVDA': { basePrice: 880, volatility: 0.04, trend: 0.002 },
                'TSLA': { basePrice: 250, volatility: 0.05, trend: 0.0015 },
                'META': { basePrice: 480, volatility: 0.035, trend: 0.0007 },
                'NFLX': { basePrice: 600, volatility: 0.03, trend: 0.0002 },
                'AMD': { basePrice: 160, volatility: 0.04, trend: 0.0012 },
                'INTC': { basePrice: 45, volatility: 0.025, trend: -0.0002 }
            };

            const results = [];
            
            // æ·»åŠ å»¶è¿Ÿæ¨¡æ‹ŸAPIè°ƒç”¨
            await new Promise(resolve => setTimeout(resolve, 800));
            
            for (const symbol of symbols.slice(0, 20)) { // é™åˆ¶æ•°é‡
                const profile = stockProfiles[symbol] || {
                    basePrice: Math.random() * 500 + 50,
                    volatility: Math.random() * 0.03 + 0.01,
                    trend: (Math.random() - 0.5) * 0.002
                };
                
                // ç”Ÿæˆä»·æ ¼å˜åŒ–
                const periodMultiplier = period === 'day' ? 1 : period === 'week' ? 7 : 30;
                const randomFactor = (Math.random() - 0.5) * 2;
                const trendFactor = profile.trend * periodMultiplier;
                const volatilityFactor = profile.volatility * Math.sqrt(periodMultiplier) * randomFactor;
                
                const changePercent = (trendFactor + volatilityFactor) * 100;
                const currentPrice = profile.basePrice * (1 + changePercent / 100);
                
                // åªè¿”å›ä¸Šæ¶¨çš„è‚¡ç¥¨
                if (changePercent > 0) {
                    results.push({
                        symbol: symbol,
                        company: getCompanyName(symbol),
                        price: currentPrice,
                        change: changePercent,
                        volume: Math.floor(Math.random() * 50000000) + 1000000,
                        currency: 'USD',
                        lastUpdate: new Date().toISOString()
                    });
                }
            }
            
            return results.sort((a, b) => b.change - a.change);
        }

        // è·å–å…¬å¸åç§°
        function getCompanyName(symbol) {
            const companies = {
                'AAPL': 'Apple Inc.',
                'MSFT': 'Microsoft Corporation',
                'GOOGL': 'Alphabet Inc.',
                'AMZN': 'Amazon.com Inc.',
                'NVDA': 'NVIDIA Corporation',
                'TSLA': 'Tesla Inc.',
                'META': 'Meta Platforms Inc.',
                'NFLX': 'Netflix Inc.',
                'AMD': 'Advanced Micro Devices Inc.',
                'INTC': 'Intel Corporation',
                'ORCL': 'Oracle Corporation',
                'CRM': 'Salesforce Inc.',
                'ADBE': 'Adobe Inc.',
                'PYPL': 'PayPal Holdings Inc.',
                'CMCSA': 'Comcast Corporation',
                'AVGO': 'Broadcom Inc.',
                'TXN': 'Texas Instruments Inc.',
                'COST': 'Costco Wholesale Corporation',
                'QCOM': 'Qualcomm Inc.',
                'TMUS': 'T-Mobile US Inc.'
            };
            return companies[symbol] || `${symbol} Corporation`;
        }

        // è·å–å®æ—¶è‚¡ç¥¨æ•°æ®
        async function getRealTimeStockData(period = 'day', minPrice = 0.1) {
            try {
                const data = await fetchStockData(popularStocks, period);
                
                // è¿‡æ»¤å’Œæ’åº
                const filteredData = data
                    .filter(stock => stock && stock.price >= minPrice && stock.change > 0)
                    .sort((a, b) => b.change - a.change);
                
                return filteredData;
            } catch (error) {
                console.error('è·å–å®æ—¶æ•°æ®å¤±è´¥:', error);
                throw error;
            }
        }

        const elements = {
            searchBtn: document.getElementById('searchBtn'),
            refreshBtn: document.getElementById('refreshBtn'),
            generateCodeBtn: document.getElementById('generateCodeBtn'),
            period: document.getElementById('period'),
            topN: document.getElementById('topN'),
            minPrice: document.getElementById('minPrice'),
            loading: document.getElementById('loading'),
            error: document.getElementById('error'),
            success: document.getElementById('success'),
            results: document.getElementById('results')
        };

        function showLoading() {
            elements.loading.style.display = 'block';
            elements.error.style.display = 'none';
            elements.success.style.display = 'none';
            elements.results.innerHTML = '';
            elements.searchBtn.disabled = true;
        }

        function hideLoading() {
            elements.loading.style.display = 'none';
            elements.searchBtn.disabled = false;
        }

        function showError(message) {
            elements.error.textContent = message;
            elements.error.style.display = 'block';
            elements.success.style.display = 'none';
            hideLoading();
        }

        function showSuccess(message) {
            elements.success.textContent = message;
            elements.success.style.display = 'block';
            elements.error.style.display = 'none';
        }

        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(1) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(1) + 'K';
            }
            return volume.toString();
        }

        function formatPrice(price) {
            return '$' + price.toFixed(2);
        }

        function createStockCard(stock, index) {
            const changeColor = stock.change > 0 ? '#27ae60' : '#e74c3c';
            const changeIcon = stock.change > 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
            const dataSourceTag = stock.dataSource !== 'mock' ? `<div class="data-source-tag">çœŸå®æ•°æ®</div>` : '';
            
            return `
                <div class="stock-card">
                    ${dataSourceTag}
                    <div class="rank">${index + 1}</div>
                    <div class="symbol">${stock.symbol}</div>
                    <div class="company-name">${stock.company}</div>
                    <div class="price-info">
                        <div class="price">${formatPrice(stock.price)}</div>
                        <div class="change" style="background: ${changeColor};">
                            ${changeIcon} ${stock.change > 0 ? '+' : ''}${stock.change.toFixed(2)}%
                        </div>
                    </div>
                    <div class="volume">æˆäº¤é‡: ${formatVolume(stock.volume)}</div>
                    <div class="volume" style="margin-top: 5px; font-size: 0.7em;">
                        è´§å¸: ${stock.currency || 'USD'}
                    </div>
                </div>
            `;
        }

        function displayResults(data, period) {
            const topN = parseInt(elements.topN.value);
            const minPrice = parseFloat(elements.minPrice.value);
            
            // è¿‡æ»¤å’Œæ’åºæ•°æ®
            let filteredData = data.filter(stock => stock.price >= minPrice);
            filteredData = filteredData.slice(0, topN);
            
            if (filteredData.length === 0) {
                showError('æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨æ•°æ®');
                return;
            }

            const periodNames = {
                day: 'ä»Šæ—¥',
                week: 'æœ¬å‘¨',
                month: 'æœ¬æœˆ'
            };

            const resultsHTML = `
                <div class="summary">
                    <h3>${periodNames[period]}æ¶¨å¹…å‰${topN}åè‚¡ç¥¨</h3>
                    <p>å·²è¿‡æ»¤ä»·æ ¼ä½äº$${minPrice.toFixed(2)}çš„è‚¡ç¥¨</p>
                </div>
                <div class="date-section">
                    <div class="date-title">${periodNames[period]}æ¶¨å¹…æ’è¡Œæ¦œ</div>
                    <div class="stock-grid">
                        ${filteredData.map((stock, index) => createStockCard(stock, index)).join('')}
                    </div>
                </div>
            `;

            elements.results.innerHTML = resultsHTML;
        }

        async function searchStocks() {
            showLoading();
            
            try {
                const period = elements.period.value;
                const minPrice = parseFloat(elements.minPrice.value) || 0.1;
                
                // æ›´æ–°åŠ è½½çŠ¶æ€
                elements.loading.innerHTML = `
                    <div>æ­£åœ¨è·å–è‚¡ç¥¨æ•°æ®...</div>
                    <div style="margin-top: 10px; font-size: 14px;">å°è¯•è¿æ¥APIæœåŠ¡...</div>
                `;
                
                // è·å–æ•°æ®
                const data = await getRealTimeStockData(period, minPrice);
                
                if (data && data.length > 0) {
                    displayResults(data, period);
                } else {
                    showError('æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨æ•°æ®ï¼Œè¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶');
                }
                
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                showError('è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                hideLoading();
            }
        }

        function generatePythonCode() {
            const period = elements.period.value;
            const topN = elements.topN.value;
            const minPrice = elements.minPrice.value;
            
            const code = `
import yfinance as yf
import pandas as pd
import requests
from datetime import datetime, timedelta
import json

def get_stock_gainers(period='${period}', top_n=${topN}, min_price=${minPrice}):
    """
    è·å–ç¾è‚¡æ¶¨å¹…æ’åå‰Nçš„è‚¡ç¥¨
    
    å‚æ•°:
    period: æ—¶é—´å‘¨æœŸ ('day', 'week', 'month')
    top_n: è¿”å›å‰Nåè‚¡ç¥¨
    min_price: æœ€ä½ä»·æ ¼è¿‡æ»¤
    """
    
    # æ–¹æ³•1: ä½¿ç”¨Yahoo Finance API
    def get_yahoo_gainers():
        import yfinance as yf
        
        # è·å–æ ‡æ™®500æˆåˆ†è‚¡
        sp500 = pd.read_html('https://en.wikipedia.org/wiki/List_of_S%26P_500_companies')[0]
        symbols = sp500['Symbol'].tolist()
        
        gainers = []
        for symbol in symbols[:100]:  # é™åˆ¶æ•°é‡é¿å…è¯·æ±‚è¿‡å¤š
            try:
                stock = yf.Ticker(symbol)
                hist = stock.history(period='5d')
                if len(hist) >= 2:
                    current_price = hist['Close'].iloc[-1]
                    if current_price >= min_price:
                        if period == 'day':
                            prev_price = hist['Close'].iloc[-2]
                        elif period == 'week':
                            prev_price = hist['Close'].iloc[0]
                        else:  # month
                            hist_month = stock.history(period='1mo')
                            prev_price = hist_month['Close'].iloc[0]
                        
                        change_pct = ((current_price - prev_price) / prev_price) * 100
                        if change_pct > 0:
                            gainers.append({
                                'symbol': symbol,
                                'price': current_price,
                                'change': change_pct,
                                'volume': hist['Volume'].iloc[-1]
                            })
            except Exception as e:
                continue
        
        return sorted(gainers, key=lambda x: x['change'], reverse=True)[:top_n]
    
    # æ–¹æ³•2: ä½¿ç”¨Alpha Vantage API
    def get_alpha_vantage_gainers():
        API_KEY = '${apiConfig.alphaVantage.key || 'YOUR_API_KEY'}'  # éœ€è¦ç”³è¯·APIå¯†é’¥
        url = f'https://www.alphavantage.co/query?function=TOP_GAINERS_LOSERS&apikey={API_KEY}'
        
        try:
            response = requests.get(url)
            data = response.json()
            
            gainers = []
            for item in data.get('top_gainers', []):
                price = float(item['price'])
                if price >= min_price:
                    gainers.append({
                        'symbol': item['ticker'],
                        'price': price,
                        'change': float(item['change_percentage'].replace('%', '')),
                        'volume': int(item['volume'])
                    })
            
            return gainers[:top_n]
        except Exception as e:
            print(f"Alpha Vantage APIé”™è¯¯: {e}")
            return []
    
    # æ–¹æ³•3: ä½¿ç”¨Finnhub API
    def get_finnhub_gainers():
        API_KEY = '${apiConfig.finnhub.key || 'YOUR_FINNHUB_KEY'}'  # éœ€è¦ç”³è¯·APIå¯†é’¥
        
        # è·å–ç¾è‚¡ç¬¦å·
        symbols_url = f'https://finnhub.io/api/v1/stock/symbol?exchange=US&token={API_KEY}'
        
        try:
            response = requests.get(symbols_url)
            symbols = response.json()[:100]  # é™åˆ¶æ•°é‡
            
            gainers = []
            for symbol_info in symbols:
                symbol = symbol_info['symbol']
                quote_url = f'https://finnhub.io/api/v1/quote?symbol={symbol}&token={API_KEY}'
                
                try:
                    quote_response = requests.get(quote_url)
                    quote = quote_response.json()
                    
                    if quote['dp'] > 0 and quote['c'] >= min_price:
                        gainers.append({
                            'symbol': symbol,
                            'price': quote['c'],
                            'change': quote['dp'],
                            'volume': quote.get('v', 0)
                        })
                except:
                    continue
            
            return sorted(gainers, key=lambda x: x['change'], reverse=True)[:top_n]
        except Exception as e:
            print(f"Finnhub APIé”™è¯¯: {e}")
            return []
    
    # å°è¯•è·å–æ•°æ®
    try:
        # ä¼˜å…ˆä½¿ç”¨Yahoo Finance
        gainers = get_yahoo_gainers()
        if not gainers:
            # å¤‡ç”¨Alpha Vantage
            gainers = get_alpha_vantage_gainers()
        if not gainers:
            # å¤‡ç”¨Finnhub
            gainers = get_finnhub_gainers()
        
        return gainers
    except Exception as e:
        print(f"è·å–æ•°æ®å¤±è´¥: {e}")
        return []

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    print("æ­£åœ¨è·å–ç¾è‚¡æ¶¨å¹…æ’å...")
    gainers = get_stock_gainers()
    
    if gainers:
        print(f"\\n{'='*60}")
        print(f"{'æ’å':<4} {'è‚¡ç¥¨ä»£ç ':<8} {'å½“å‰ä»·æ ¼':<12} {'æ¶¨å¹…':<12} {'æˆäº¤é‡':<15}")
        print(f"{'='*60}")
        
        for i, stock in enumerate(gainers, 1):
            print(f"{i:<4} {stock['symbol']:<8} ${stock['price']:<11.2f} {stock['change']:<11.2f}% {stock['volume']:,}")
    else:
        print("æœªèƒ½è·å–åˆ°æ•°æ®ï¼Œè¯·æ£€æŸ¥APIé…ç½®")

# å®šæ—¶æ‰§è¡Œç‰ˆæœ¬
import schedule
import time

def job():
    print(f"\\n[{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] å¼€å§‹è·å–è‚¡ç¥¨æ•°æ®...")
    gainers = get_stock_gainers()
    
    if gainers:
        # ä¿å­˜åˆ°CSVæ–‡ä»¶
        df = pd.DataFrame(gainers)
        filename = f"stock_gainers_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv"
        df.to_csv(filename, index=False)
        print(f"æ•°æ®å·²ä¿å­˜åˆ°: {filename}")
        
        # æ‰“å°ç»“æœ
        for i, stock in enumerate(gainers, 1):
            print(f"{i}. {stock['symbol']}: +{stock['change']:.2f}% (${stock['price']:.2f})")

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
schedule.every().hour.do(job)

# è¿è¡Œè°ƒåº¦å™¨
# while True:
#     schedule.run_pending()
#     time.sleep(1)
`;

            // åˆ›å»ºå¹¶ä¸‹è½½ä»£ç æ–‡ä»¶
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'stock_gainers_tracker.py';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Pythonä»£ç å·²ç”Ÿæˆå¹¶ä¸‹è½½ï¼\\n\\nä»£ç åŒ…å«ä¸‰ç§APIè·å–æ–¹å¼ï¼š\\n1. Yahoo Finance (å…è´¹)\\n2. Alpha Vantage (éœ€è¦APIå¯†é’¥)\\n3. Finnhub (éœ€è¦APIå¯†é’¥)\\n\\nä»£ç ä¸­å·²åŒ…å«æ‚¨é…ç½®çš„APIå¯†é’¥ï¼ˆå¦‚æœæœ‰ï¼‰');
        }

        // äº‹ä»¶ç›‘å¬
        elements.searchBtn.addEventListener('click', searchStocks);
        elements.refreshBtn.addEventListener('click', searchStocks);
        elements.generateCodeBtn.addEventListener('click', generatePythonCode);

        // APIè¾“å…¥æ¡†äº‹ä»¶
        document.getElementById('alphaVantageKey').addEventListener('change', saveApiKeys);
        document.getElementById('finnhubKey').addEventListener('change', saveApiKeys);
        document.getElementById('polygonKey').addEventListener('change', saveApiKeys);

        // æ·»åŠ å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                searchStocks();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åŠ è½½ä¿å­˜çš„APIå¯†é’¥å¹¶è‡ªåŠ¨è·å–æ•°æ®
        window.addEventListener('load', () => {
            loadApiKeys();
            setTimeout(searchStocks, 500);
        });
    </script>
</body>
</html>