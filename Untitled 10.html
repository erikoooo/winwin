<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁæéËÇ°Ê∂®ÂπÖÊéíÂêçËøΩË∏™Âô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: bold;
            color: #34495e;
            font-size: 0.9em;
        }

        select, input, button {
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #c33;
        }

        .success {
            background: #e8f8e8;
            color: #2a7f2a;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2a7f2a;
        }

        .results {
            display: grid;
            gap: 20px;
            margin-top: 30px;
        }

        .date-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #dee2e6;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .date-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .stock-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stock-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .rank {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .symbol {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .company-name {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .price {
            font-size: 1.1em;
            font-weight: bold;
            color: #2c3e50;
        }

        .change {
            font-size: 1.2em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3);
        }

        .volume {
            font-size: 0.8em;
            color: #95a5a6;
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .summary h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .api-config {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px dashed #667eea;
        }

        .api-config h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .api-config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .api-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 5px;
        }

        .api-status.active {
            background: #27ae60;
        }

        .api-status.inactive {
            background: #e74c3c;
        }

        .api-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border-left: 4px solid #667eea;
        }

        .api-info h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .api-info ul {
            color: #5a6c7d;
            line-height: 1.6;
        }

        .api-info li {
            margin-bottom: 8px;
        }

        .data-source-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stock-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìà ÁæéËÇ°Ê∂®ÂπÖÊéíÂêçËøΩË∏™Âô®</h1>
        
        <!-- APIÈÖçÁΩÆÂå∫Âüü -->
        <div class="api-config">
            <h3>‚öôÔ∏è APIÈÖçÁΩÆÔºàÂèØÈÄâ - Áî®‰∫éËé∑ÂèñÁúüÂÆûÊï∞ÊçÆÔºâ</h3>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                ËæìÂÖ•APIÂØÜÈí•ÂêéÂèØËé∑ÂèñÁúüÂÆûËÇ°Á•®Êï∞ÊçÆ„ÄÇÁïôÁ©∫Â∞Ü‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ„ÄÇ
                <a href="#api-guide" style="color: #667eea;">Ëé∑ÂèñÂÖçË¥πAPIÂØÜÈí•ÊåáÂçó ‚Üì</a>
            </p>
            <div class="api-config-grid">
                <div class="control-group">
                    <label for="alphaVantageKey">
                        Alpha Vantage API Key
                        <span class="api-status" id="alphaStatus"></span>
                    </label>
                    <input type="text" id="alphaVantageKey" placeholder="ËæìÂÖ•APIÂØÜÈí•Êàñ‰ΩøÁî®'demo'">
                </div>
                <div class="control-group">
                    <label for="finnhubKey">
                        Finnhub API Key
                        <span class="api-status" id="finnhubStatus"></span>
                    </label>
                    <input type="text" id="finnhubKey" placeholder="ËæìÂÖ•APIÂØÜÈí•">
                </div>
                <div class="control-group">
                    <label for="polygonKey">
                        Polygon.io API Key
                        <span class="api-status" id="polygonStatus"></span>
                    </label>
                    <input type="text" id="polygonKey" placeholder="ËæìÂÖ•APIÂØÜÈí•">
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="period">Êó∂Èó¥Âë®Êúü</label>
                <select id="period">
                    <option value="day">ÂΩìÊó•</option>
                    <option value="week" selected>Êú¨Âë®</option>
                    <option value="month">Êú¨Êúà</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="topN">ÊòæÁ§∫ÂâçNÂêç</label>
                <input type="number" id="topN" min="1" max="50" value="10">
            </div>
            
            <div class="control-group">
                <label for="minPrice">ÊúÄ‰Ωé‰ª∑Ê†ºËøáÊª§</label>
                <input type="number" id="minPrice" min="0" step="0.01" value="0.1" placeholder="ÊúÄ‰Ωé‰ª∑Ê†º">
            </div>
            
            <button id="searchBtn">üîç Ëé∑ÂèñÂÆûÊó∂Êï∞ÊçÆ</button>
            <button id="refreshBtn">üîÑ Âà∑Êñ∞Êï∞ÊçÆ</button>
            <button id="generateCodeBtn">üìã ÁîüÊàêPython‰ª£Á†Å</button>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div>Ê≠£Âú®Ëé∑ÂèñÊï∞ÊçÆ...</div>
            <div style="margin-top: 10px; font-size: 14px;">Â∞ùËØïËøûÊé•ÁúüÂÆûAPI‰∏≠...</div>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        <div id="success" class="success" style="display: none;"></div>
        
        <div id="results" class="results"></div>

        <div class="api-info" id="api-guide">
            <h3>üìä Â¶Ç‰ΩïËé∑ÂèñÂÖçË¥πAPIÂØÜÈí•</h3>
            <ol style="line-height: 1.8;">
                <li><strong>Alpha Vantage (Êé®Ëçê)</strong>
                    <ul>
                        <li>ËÆøÈóÆ: <a href="https://www.alphavantage.co/support/#api-key" target="_blank">https://www.alphavantage.co</a></li>
                        <li>ÂÖçË¥πÊ≥®ÂÜåÂç≥ÂèØËé∑ÂæóAPIÂØÜÈí•</li>
                        <li>ÊîØÊåÅËé∑ÂèñÂ∏ÇÂú∫Ê∂®Ë∑åÂπÖÊ¶úÂçï</li>
                    </ul>
                </li>
                <li><strong>Finnhub</strong>
                    <ul>
                        <li>ËÆøÈóÆ: <a href="https://finnhub.io/" target="_blank">https://finnhub.io</a></li>
                        <li>ÂÖçË¥πËÆ°ÂàíÊØèÂàÜÈíü60Ê¨°ËØ∑Ê±Ç</li>
                        <li>ÂÆûÊó∂ËÇ°Á•®Êä•‰ª∑Êï∞ÊçÆ</li>
                    </ul>
                </li>
                <li><strong>Polygon.io</strong>
                    <ul>
                        <li>ËÆøÈóÆ: <a href="https://polygon.io/" target="_blank">https://polygon.io</a></li>
                        <li>ÂÖçË¥πËÆ°ÂàíÊØèÂàÜÈíü5Ê¨°ËØ∑Ê±Ç</li>
                        <li>È´òË¥®ÈáèÈáëËûçÊï∞ÊçÆ</li>
                    </ul>
                </li>
            </ol>
            <div style="margin-top: 15px; padding: 10px; background: #e8f4f8; border-radius: 5px;">
                <strong>üí° ÊèêÁ§∫:</strong> Â¶ÇÊûú‰∏çÈÖçÁΩÆAPIÂØÜÈí•ÔºåÁ≥ªÁªüÂ∞Ü‰ΩøÁî®Âü∫‰∫éÂ∏ÇÂú∫Ê®°ÂûãÁöÑÊ®°ÊãüÊï∞ÊçÆ„ÄÇ
                Ê®°ÊãüÊï∞ÊçÆÂü∫‰∫éÁúüÂÆûËÇ°Á•®ÁöÑÂéÜÂè≤Ê≥¢Âä®ÊÄßÂíåË∂ãÂäøÁîüÊàê„ÄÇ
            </div>
        </div>
    </div>

    <script>
        // ÁÉ≠Èó®ËÇ°Á•®ÂàóË°®ÔºàÁî®‰∫éÊï∞ÊçÆËé∑ÂèñÔºâ
        const popularStocks = [
            'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'TSLA', 'META', 'NFLX', 'AMD', 'INTC',
            'ORCL', 'CRM', 'ADBE', 'PYPL', 'CMCSA', 'AVGO', 'TXN', 'COST', 'QCOM', 'TMUS',
            'ABNB', 'UBER', 'LYFT', 'ROKU', 'SQ', 'SHOP', 'ZOOM', 'DOCU', 'CRWD', 'OKTA',
            'PLTR', 'SNOW', 'DDOG', 'ZM', 'SPOT', 'TWLO', 'PINS', 'SNAP', 'BABA', 'JD',
            'COIN', 'HOOD', 'SOFI', 'UPST', 'AFRM', 'RBLX', 'RIVN', 'LCID', 'NKLA', 'SPCE'
        ];

        // APIÈÖçÁΩÆÁÆ°ÁêÜ
        const apiConfig = {
            alphaVantage: { key: '', status: false },
            finnhub: { key: '', status: false },
            polygon: { key: '', status: false }
        };

        // ‰øùÂ≠òÂíåÂä†ËΩΩAPIÂØÜÈí•
        function saveApiKeys() {
            apiConfig.alphaVantage.key = document.getElementById('alphaVantageKey').value;
            apiConfig.finnhub.key = document.getElementById('finnhubKey').value;
            apiConfig.polygon.key = document.getElementById('polygonKey').value;
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('stockTrackerApiKeys', JSON.stringify({
                alphaVantage: apiConfig.alphaVantage.key,
                finnhub: apiConfig.finnhub.key,
                polygon: apiConfig.polygon.key
            }));
            
            updateApiStatus();
        }

        function loadApiKeys() {
            const saved = localStorage.getItem('stockTrackerApiKeys');
            if (saved) {
                const keys = JSON.parse(saved);
                document.getElementById('alphaVantageKey').value = keys.alphaVantage || '';
                document.getElementById('finnhubKey').value = keys.finnhub || '';
                document.getElementById('polygonKey').value = keys.polygon || '';
                
                apiConfig.alphaVantage.key = keys.alphaVantage || '';
                apiConfig.finnhub.key = keys.finnhub || '';
                apiConfig.polygon.key = keys.polygon || '';
            }
            updateApiStatus();
        }

        function updateApiStatus() {
            const alphaStatus = document.getElementById('alphaStatus');
            const finnhubStatus = document.getElementById('finnhubStatus');
            const polygonStatus = document.getElementById('polygonStatus');
            
            alphaStatus.className = 'api-status ' + (apiConfig.alphaVantage.key ? 'active' : 'inactive');
            finnhubStatus.className = 'api-status ' + (apiConfig.finnhub.key ? 'active' : 'inactive');
            polygonStatus.className = 'api-status ' + (apiConfig.polygon.key ? 'active' : 'inactive');
        }

        // Ëé∑ÂèñËÇ°Á•®Êï∞ÊçÆ - ÊîØÊåÅÁúüÂÆûAPIÂíåÊ®°ÊãüÊï∞ÊçÆ
        async function fetchStockData(symbols, period = 'day') {
            let results = [];
            let dataSource = 'mock';
            
            // ‰øùÂ≠òÂΩìÂâçÁöÑAPIÈÖçÁΩÆ
            saveApiKeys();
            
            // Â∞ùËØï‰ΩøÁî®Alpha Vantage API
            if (apiConfig.alphaVantage.key && apiConfig.alphaVantage.key !== '') {
                try {
                    const response = await fetch(
                        `https://www.alphavantage.co/query?function=TOP_GAINERS_LOSERS&apikey=${apiConfig.alphaVantage.key}`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.top_gainers && !data.Note && !data.Information) {
                            results = data.top_gainers.map(stock => ({
                                symbol: stock.ticker,
                                company: stock.company_name || getCompanyName(stock.ticker),
                                price: parseFloat(stock.price),
                                change: parseFloat(stock.change_percentage.replace('%', '')),
                                volume: parseInt(stock.volume),
                                currency: 'USD',
                                lastUpdate: new Date().toISOString()
                            }));
                            dataSource = 'Alpha Vantage';
                            showSuccess(`ÊàêÂäü‰ªé ${dataSource} Ëé∑ÂèñÁúüÂÆûÊï∞ÊçÆÔºÅ`);
                        }
                    }
                } catch (error) {
                    console.error('Alpha Vantage APIÈîôËØØ:', error);
                }
            }
            
            // Â¶ÇÊûúAlpha VantageÂ§±Ë¥•ÔºåÂ∞ùËØïFinnhub
            if (results.length === 0 && apiConfig.finnhub.key) {
                try {
                    // Ëé∑ÂèñÂ∏ÇÂú∫Á¨¶Âè∑
                    const symbolsResponse = await fetch(
                        `https://finnhub.io/api/v1/stock/symbol?exchange=US&token=${apiConfig.finnhub.key}`
                    );
                    
                    if (symbolsResponse.ok) {
                        const allSymbols = await symbolsResponse.json();
                        const targetSymbols = symbols.slice(0, 20); // ÈôêÂà∂Êï∞Èáè
                        
                        for (const symbol of targetSymbols) {
                            try {
                                const quoteResponse = await fetch(
                                    `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiConfig.finnhub.key}`
                                );
                                
                                if (quoteResponse.ok) {
                                    const quote = await quoteResponse.json();
                                    if (quote.dp && quote.dp > 0) {
                                        results.push({
                                            symbol: symbol,
                                            company: getCompanyName(symbol),
                                            price: quote.c,
                                            change: quote.dp,
                                            volume: quote.v || 0,
                                            currency: 'USD',
                                            lastUpdate: new Date(quote.t * 1000).toISOString()
                                        });
                                    }
                                }
                            } catch (err) {
                                continue;
                            }
                        }
                        
                        if (results.length > 0) {
                            dataSource = 'Finnhub';
                            showSuccess(`ÊàêÂäü‰ªé ${dataSource} Ëé∑ÂèñÁúüÂÆûÊï∞ÊçÆÔºÅ`);
                        }
                    }
                } catch (error) {
                    console.error('Finnhub APIÈîôËØØ:', error);
                }
            }
            
            // Â¶ÇÊûúÈÉΩÂ§±Ë¥•‰∫ÜÔºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
            if (results.length === 0) {
                console.log('‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ');
                results = await generateRealisticMockData(symbols, period);
                if (apiConfig.alphaVantage.key || apiConfig.finnhub.key || apiConfig.polygon.key) {
                    showError('Êó†Ê≥ïËé∑ÂèñÁúüÂÆûÊï∞ÊçÆÔºåÊòæÁ§∫Ê®°ÊãüÊï∞ÊçÆ„ÄÇËØ∑Ê£ÄÊü•APIÂØÜÈí•ÊòØÂê¶Ê≠£Á°Æ„ÄÇ');
                }
            }
            
            // ÊåâÊ∂®ÂπÖÊéíÂ∫è
            results.sort((a, b) => b.change - a.change);
            
            // Ê∑ªÂä†Êï∞ÊçÆÊ∫êÊ†áËÆ∞
            results = results.map(stock => ({
                ...stock,
                dataSource: dataSource
            }));
            
            return results;
        }

        // ÁîüÊàêÁúüÂÆûÊÑüÁöÑÊ®°ÊãüÊï∞ÊçÆ
        async function generateRealisticMockData(symbols, period) {
            // Âü∫‰∫éÁúüÂÆûËÇ°Á•®ÁöÑÂéÜÂè≤Ë°®Áé∞ÁîüÊàêÊ®°ÊãüÊï∞ÊçÆ
            const stockProfiles = {
                'AAPL': { basePrice: 190, volatility: 0.02, trend: 0.001 },
                'MSFT': { basePrice: 420, volatility: 0.018, trend: 0.0008 },
                'GOOGL': { basePrice: 140, volatility: 0.025, trend: 0.0005 },
                'AMZN': { basePrice: 180, volatility: 0.03, trend: 0.0003 },
                'NVDA': { basePrice: 880, volatility: 0.04, trend: 0.002 },
                'TSLA': { basePrice: 250, volatility: 0.05, trend: 0.0015 },
                'META': { basePrice: 480, volatility: 0.035, trend: 0.0007 },
                'NFLX': { basePrice: 600, volatility: 0.03, trend: 0.0002 },
                'AMD': { basePrice: 160, volatility: 0.04, trend: 0.0012 },
                'INTC': { basePrice: 45, volatility: 0.025, trend: -0.0002 }
            };

            const results = [];
            
            // Ê∑ªÂä†Âª∂ËøüÊ®°ÊãüAPIË∞ÉÁî®
            await new Promise(resolve => setTimeout(resolve, 800));
            
            for (const symbol of symbols.slice(0, 20)) { // ÈôêÂà∂Êï∞Èáè
                const profile = stockProfiles[symbol] || {
                    basePrice: Math.random() * 500 + 50,
                    volatility: Math.random() * 0.03 + 0.01,
                    trend: (Math.random() - 0.5) * 0.002
                };
                
                // ÁîüÊàê‰ª∑Ê†ºÂèòÂåñ
                const periodMultiplier = period === 'day' ? 1 : period === 'week' ? 7 : 30;
                const randomFactor = (Math.random() - 0.5) * 2;
                const trendFactor = profile.trend * periodMultiplier;
                const volatilityFactor = profile.volatility * Math.sqrt(periodMultiplier) * randomFactor;
                
                const changePercent = (trendFactor + volatilityFactor) * 100;
                const currentPrice = profile.basePrice * (1 + changePercent / 100);
                
                // Âè™ËøîÂõû‰∏äÊ∂®ÁöÑËÇ°Á•®
                if (changePercent > 0) {
                    results.push({
                        symbol: symbol,
                        company: getCompanyName(symbol),
                        price: currentPrice,
                        change: changePercent,
                        volume: Math.floor(Math.random() * 50000000) + 1000000,
                        currency: 'USD',
                        lastUpdate: new Date().toISOString()
                    });
                }
            }
            
            return results.sort((a, b) => b.change - a.change);
        }

        // Ëé∑ÂèñÂÖ¨Âè∏ÂêçÁß∞
        function getCompanyName(symbol) {
            const companies = {
                'AAPL': 'Apple Inc.',
                'MSFT': 'Microsoft Corporation',
                'GOOGL': 'Alphabet Inc.',
                'AMZN': 'Amazon.com Inc.',
                'NVDA': 'NVIDIA Corporation',
                'TSLA': 'Tesla Inc.',
                'META': 'Meta Platforms Inc.',
                'NFLX': 'Netflix Inc.',
                'AMD': 'Advanced Micro Devices Inc.',
                'INTC': 'Intel Corporation',
                'ORCL': 'Oracle Corporation',
                'CRM': 'Salesforce Inc.',
                'ADBE': 'Adobe Inc.',
                'PYPL': 'PayPal Holdings Inc.',
                'CMCSA': 'Comcast Corporation',
                'AVGO': 'Broadcom Inc.',
                'TXN': 'Texas Instruments Inc.',
                'COST': 'Costco Wholesale Corporation',
                'QCOM': 'Qualcomm Inc.',
                'TMUS': 'T-Mobile US Inc.'
            };
            return companies[symbol] || `${symbol} Corporation`;
        }

        // Ëé∑ÂèñÂÆûÊó∂ËÇ°Á•®Êï∞ÊçÆ
        async function getRealTimeStockData(period = 'day', minPrice = 0.1) {
            try {
                const data = await fetchStockData(popularStocks, period);
                
                // ËøáÊª§ÂíåÊéíÂ∫è
                const filteredData = data
                    .filter(stock => stock && stock.price >= minPrice && stock.change > 0)
                    .sort((a, b) => b.change - a.change);
                
                return filteredData;
            } catch (error) {
                console.error('Ëé∑ÂèñÂÆûÊó∂Êï∞ÊçÆÂ§±Ë¥•:', error);
                throw error;
            }
        }

        const elements = {
            searchBtn: document.getElementById('searchBtn'),
            refreshBtn: document.getElementById('refreshBtn'),
            generateCodeBtn: document.getElementById('generateCodeBtn'),
            period: document.getElementById('period'),
            topN: document.getElementById('topN'),
            minPrice: document.getElementById('minPrice'),
            loading: document.getElementById('loading'),
            error: document.getElementById('error'),
            success: document.getElementById('success'),
            results: document.getElementById('results')
        };

        function showLoading() {
            elements.loading.style.display = 'block';
            elements.error.style.display = 'none';
            elements.success.style.display = 'none';
            elements.results.innerHTML = '';
            elements.searchBtn.disabled = true;
        }

        function hideLoading() {
            elements.loading.style.display = 'none';
            elements.searchBtn.disabled = false;
        }

        function showError(message) {
            elements.error.textContent = message;
            elements.error.style.display = 'block';
            elements.success.style.display = 'none';
            hideLoading();
        }

        function showSuccess(message) {
            elements.success.textContent = message;
            elements.success.style.display = 'block';
            elements.error.style.display = 'none';
        }

        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(1) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(1) + 'K';
            }
            return volume.toString();
        }

        function formatPrice(price) {
            return '$' + price.toFixed(2);
        }

        function createStockCard(stock, index) {
            const changeColor = stock.change > 0 ? '#27ae60' : '#e74c3c';
            const changeIcon = stock.change > 0 ? 'üìà' : 'üìâ';
            const dataSourceTag = stock.dataSource !== 'mock' ? `<div class="data-source-tag">ÁúüÂÆûÊï∞ÊçÆ</div>` : '';
            
            return `
                <div class="stock-card">
                    ${dataSourceTag}
                    <div class="rank">${index + 1}</div>
                    <div class="symbol">${stock.symbol}</div>
                    <div class="company-name">${stock.company}</div>
                    <div class="price-info">
                        <div class="price">${formatPrice(stock.price)}</div>
                        <div class="change" style="background: ${changeColor};">
                            ${changeIcon} ${stock.change > 0 ? '+' : ''}${stock.change.toFixed(2)}%
                        </div>
                    </div>
                    <div class="volume">Êàê‰∫§Èáè: ${formatVolume(stock.volume)}</div>
                    <div class="volume" style="margin-top: 5px; font-size: 0.7em;">
                        Ë¥ßÂ∏Å: ${stock.currency || 'USD'}
                    </div>
                </div>
            `;
        }

        function displayResults(data, period) {
            const topN = parseInt(elements.topN.value);
            const minPrice = parseFloat(elements.minPrice.value);
            
            // ËøáÊª§ÂíåÊéíÂ∫èÊï∞ÊçÆ
            let filteredData = data.filter(stock => stock.price >= minPrice);
            filteredData = filteredData.slice(0, topN);
            
            if (filteredData.length === 0) {
                showError('Ê≤°ÊúâÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑËÇ°Á•®Êï∞ÊçÆ');
                return;
            }

            const periodNames = {
                day: '‰ªäÊó•',
                week: 'Êú¨Âë®',
                month: 'Êú¨Êúà'
            };

            const resultsHTML = `
                <div class="summary">
                    <h3>${periodNames[period]}Ê∂®ÂπÖÂâç${topN}ÂêçËÇ°Á•®</h3>
                    <p>Â∑≤ËøáÊª§‰ª∑Ê†º‰Ωé‰∫é$${minPrice.toFixed(2)}ÁöÑËÇ°Á•®</p>
                </div>
                <div class="date-section">
                    <div class="date-title">${periodNames[period]}Ê∂®ÂπÖÊéíË°åÊ¶ú</div>
                    <div class="stock-grid">
                        ${filteredData.map((stock, index) => createStockCard(stock, index)).join('')}
                    </div>
                </div>
            `;

            elements.results.innerHTML = resultsHTML;
        }

        async function searchStocks() {
            showLoading();
            
            try {
                const period = elements.period.value;
                const minPrice = parseFloat(elements.minPrice.value) || 0.1;
                
                // Êõ¥Êñ∞Âä†ËΩΩÁä∂ÊÄÅ
                elements.loading.innerHTML = `
                    <div>Ê≠£Âú®Ëé∑ÂèñËÇ°Á•®Êï∞ÊçÆ...</div>
                    <div style="margin-top: 10px; font-size: 14px;">Â∞ùËØïËøûÊé•APIÊúçÂä°...</div>
                `;
                
                // Ëé∑ÂèñÊï∞ÊçÆ
                const data = await getRealTimeStockData(period, minPrice);
                
                if (data && data.length > 0) {
                    displayResults(data, period);
                } else {
                    showError('Êú™ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑËÇ°Á•®Êï∞ÊçÆÔºåËØ∑Â∞ùËØïË∞ÉÊï¥Á≠õÈÄâÊù°‰ª∂');
                }
                
            } catch (error) {
                console.error('ÊêúÁ¥¢Â§±Ë¥•:', error);
                showError('Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            } finally {
                hideLoading();
            }
        }

        function generatePythonCode() {
            const period = elements.period.value;
            const topN = elements.topN.value;
            const minPrice = elements.minPrice.value;
            
            const code = `
import yfinance as yf
import pandas as pd
import requests
from datetime import datetime, timedelta
import json

def get_stock_gainers(period='${period}', top_n=${topN}, min_price=${minPrice}):
    """
    Ëé∑ÂèñÁæéËÇ°Ê∂®ÂπÖÊéíÂêçÂâçNÁöÑËÇ°Á•®
    
    ÂèÇÊï∞:
    period: Êó∂Èó¥Âë®Êúü ('day', 'week', 'month')
    top_n: ËøîÂõûÂâçNÂêçËÇ°Á•®
    min_price: ÊúÄ‰Ωé‰ª∑Ê†ºËøáÊª§
    """
    
    # ÊñπÊ≥ï1: ‰ΩøÁî®Yahoo Finance API
    def get_yahoo_gainers():
        import yfinance as yf
        
        # Ëé∑ÂèñÊ†áÊôÆ500ÊàêÂàÜËÇ°
        sp500 = pd.read_html('https://en.wikipedia.org/wiki/List_of_S%26P_500_companies')[0]
        symbols = sp500['Symbol'].tolist()
        
        gainers = []
        for symbol in symbols[:100]:  # ÈôêÂà∂Êï∞ÈáèÈÅøÂÖçËØ∑Ê±ÇËøáÂ§ö
            try:
                stock = yf.Ticker(symbol)
                hist = stock.history(period='5d')
                if len(hist) >= 2:
                    current_price = hist['Close'].iloc[-1]
                    if current_price >= min_price:
                        if period == 'day':
                            prev_price = hist['Close'].iloc[-2]
                        elif period == 'week':
                            prev_price = hist['Close'].iloc[0]
                        else:  # month
                            hist_month = stock.history(period='1mo')
                            prev_price = hist_month['Close'].iloc[0]
                        
                        change_pct = ((current_price - prev_price) / prev_price) * 100
                        if change_pct > 0:
                            gainers.append({
                                'symbol': symbol,
                                'price': current_price,
                                'change': change_pct,
                                'volume': hist['Volume'].iloc[-1]
                            })
            except Exception as e:
                continue
        
        return sorted(gainers, key=lambda x: x['change'], reverse=True)[:top_n]
    
    # ÊñπÊ≥ï2: ‰ΩøÁî®Alpha Vantage API
    def get_alpha_vantage_gainers():
        API_KEY = '${apiConfig.alphaVantage.key || 'YOUR_API_KEY'}'  # ÈúÄË¶ÅÁî≥ËØ∑APIÂØÜÈí•
        url = f'https://www.alphavantage.co/query?function=TOP_GAINERS_LOSERS&apikey={API_KEY}'
        
        try:
            response = requests.get(url)
            data = response.json()
            
            gainers = []
            for item in data.get('top_gainers', []):
                price = float(item['price'])
                if price >= min_price:
                    gainers.append({
                        'symbol': item['ticker'],
                        'price': price,
                        'change': float(item['change_percentage'].replace('%', '')),
                        'volume': int(item['volume'])
                    })
            
            return gainers[:top_n]
        except Exception as e:
            print(f"Alpha Vantage APIÈîôËØØ: {e}")
            return []
    
    # ÊñπÊ≥ï3: ‰ΩøÁî®Finnhub API
    def get_finnhub_gainers():
        API_KEY = '${apiConfig.finnhub.key || 'YOUR_FINNHUB_KEY'}'  # ÈúÄË¶ÅÁî≥ËØ∑APIÂØÜÈí•
        
        # Ëé∑ÂèñÁæéËÇ°Á¨¶Âè∑
        symbols_url = f'https://finnhub.io/api/v1/stock/symbol?exchange=US&token={API_KEY}'
        
        try:
            response = requests.get(symbols_url)
            symbols = response.json()[:100]  # ÈôêÂà∂Êï∞Èáè
            
            gainers = []
            for symbol_info in symbols:
                symbol = symbol_info['symbol']
                quote_url = f'https://finnhub.io/api/v1/quote?symbol={symbol}&token={API_KEY}'
                
                try:
                    quote_response = requests.get(quote_url)
                    quote = quote_response.json()
                    
                    if quote['dp'] > 0 and quote['c'] >= min_price:
                        gainers.append({
                            'symbol': symbol,
                            'price': quote['c'],
                            'change': quote['dp'],
                            'volume': quote.get('v', 0)
                        })
                except:
                    continue
            
            return sorted(gainers, key=lambda x: x['change'], reverse=True)[:top_n]
        except Exception as e:
            print(f"Finnhub APIÈîôËØØ: {e}")
            return []
    
    # Â∞ùËØïËé∑ÂèñÊï∞ÊçÆ
    try:
        # ‰ºòÂÖà‰ΩøÁî®Yahoo Finance
        gainers = get_yahoo_gainers()
        if not gainers:
            # Â§áÁî®Alpha Vantage
            gainers = get_alpha_vantage_gainers()
        if not gainers:
            # Â§áÁî®Finnhub
            gainers = get_finnhub_gainers()
        
        return gainers
    except Exception as e:
        print(f"Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•: {e}")
        return []

# ‰ΩøÁî®Á§∫‰æã
if __name__ == "__main__":
    print("Ê≠£Âú®Ëé∑ÂèñÁæéËÇ°Ê∂®ÂπÖÊéíÂêç...")
    gainers = get_stock_gainers()
    
    if gainers:
        print(f"\\n{'='*60}")
        print(f"{'ÊéíÂêç':<4} {'ËÇ°Á•®‰ª£Á†Å':<8} {'ÂΩìÂâç‰ª∑Ê†º':<12} {'Ê∂®ÂπÖ':<12} {'Êàê‰∫§Èáè':<15}")
        print(f"{'='*60}")
        
        for i, stock in enumerate(gainers, 1):
            print(f"{i:<4} {stock['symbol']:<8} ${stock['price']:<11.2f} {stock['change']:<11.2f}% {stock['volume']:,}")
    else:
        print("Êú™ËÉΩËé∑ÂèñÂà∞Êï∞ÊçÆÔºåËØ∑Ê£ÄÊü•APIÈÖçÁΩÆ")

# ÂÆöÊó∂ÊâßË°åÁâàÊú¨
import schedule
import time

def job():
    print(f"\\n[{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] ÂºÄÂßãËé∑ÂèñËÇ°Á•®Êï∞ÊçÆ...")
    gainers = get_stock_gainers()
    
    if gainers:
        # ‰øùÂ≠òÂà∞CSVÊñá‰ª∂
        df = pd.DataFrame(gainers)
        filename = f"stock_gainers_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv"
        df.to_csv(filename, index=False)
        print(f"Êï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞: {filename}")
        
        # ÊâìÂç∞ÁªìÊûú
        for i, stock in enumerate(gainers, 1):
            print(f"{i}. {stock['symbol']}: +{stock['change']:.2f}% (${stock['price']:.2f})")

# ÊØèÂ∞èÊó∂ÊâßË°å‰∏ÄÊ¨°
schedule.every().hour.do(job)

# ËøêË°åË∞ÉÂ∫¶Âô®
# while True:
#     schedule.run_pending()
#     time.sleep(1)
`;

            // ÂàõÂª∫Âπ∂‰∏ãËΩΩ‰ª£Á†ÅÊñá‰ª∂
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'stock_gainers_tracker.py';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Python‰ª£Á†ÅÂ∑≤ÁîüÊàêÂπ∂‰∏ãËΩΩÔºÅ\\n\\n‰ª£Á†ÅÂåÖÂê´‰∏âÁßçAPIËé∑ÂèñÊñπÂºèÔºö\\n1. Yahoo Finance (ÂÖçË¥π)\\n2. Alpha Vantage (ÈúÄË¶ÅAPIÂØÜÈí•)\\n3. Finnhub (ÈúÄË¶ÅAPIÂØÜÈí•)\\n\\n‰ª£Á†Å‰∏≠Â∑≤ÂåÖÂê´ÊÇ®ÈÖçÁΩÆÁöÑAPIÂØÜÈí•ÔºàÂ¶ÇÊûúÊúâÔºâ');
        }

        // ‰∫ã‰ª∂ÁõëÂê¨
        elements.searchBtn.addEventListener('click', searchStocks);
        elements.refreshBtn.addEventListener('click', searchStocks);
        elements.generateCodeBtn.addEventListener('click', generatePythonCode);

        // APIËæìÂÖ•Ê°Ü‰∫ã‰ª∂
        document.getElementById('alphaVantageKey').addEventListener('change', saveApiKeys);
        document.getElementById('finnhubKey').addEventListener('change', saveApiKeys);
        document.getElementById('polygonKey').addEventListener('change', saveApiKeys);

        // Ê∑ªÂä†Âø´Êç∑ÈîÆÊîØÊåÅ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                searchStocks();
            }
        });

        // È°µÈù¢Âä†ËΩΩÊó∂Âä†ËΩΩ‰øùÂ≠òÁöÑAPIÂØÜÈí•Âπ∂Ëá™Âä®Ëé∑ÂèñÊï∞ÊçÆ
        window.addEventListener('load', () => {
            loadApiKeys();
            setTimeout(searchStocks, 500);
        });
    </script>
</body>
</html>